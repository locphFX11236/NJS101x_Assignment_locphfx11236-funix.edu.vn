<%- include('includes/head.ejs') %>
    <link rel="stylesheet" href="/css/staff.css">
    <link rel="stylesheet" href="/css/form.css">
</head>

<body>
    <%- include('includes/navigation.ejs') %>
    <main class="centered">
        <section class="grid">
            <div class="card">
                <h3><%= (!user.isManager) ? 'Đăng ký nghĩ phép' : 'Thông tin nghĩ phép' %></h3>
                <p>Số ngày nghĩ phép còn lại: <%= annu.annualLeave %> ngày</p>
                <% if (!user.isManager) { %>
                    <p>Bạn <%= (annu.annualLeave <= 0) ? 'không thể' : 'có thể' %> đăng ký nghĩ phép</p>
                <% } %>
                <% if (!user.isManager) { %>
                    <form action="/post-annualLeave" method="post">
                        <div class="form-control">
                            <label for="leaveDate">Chọn ngày:</label>
                            <input type="date" name="leaveDate" id="leaveDate">
                        </div>
                        <div class="form-control">
                            <label for="leaveHour">Chọn số giờ nghĩ:</label>
                            <input type="number" name="leaveHour" id="leaveHour" min="0" max="8" step="0.25">
                        </div>
                        <div class="form-control">
                            <label for="reason">Lý do:</label>
                            <textarea name="reason" id="reason" rows="3" cols="40"></textarea>
                        </div>
                            <input type="hidden" value="<%= annu.staff_id %>" name="staff_id">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <button class="btn" type="submit" <%= (annu.annualLeave <= 0) ? 'disabled' : null %> >Đăng ký nghĩ phép</button>
                    </form>
                <% } %>
            </div>
        </section>
        <section class="card">
            <h3>Danh sách đăng ký nghĩ trong ngày</h3>
            <% if (annu.regInformation.length > 0) { %>
                <div class="grid">
                    <% for (let regInfor of annu.regInformation) { %>
                        <div class="card">
                            <p>Ngày đăng kí nghĩ phép: <%= regInfor.leaveDate %></p>
                            <p>Thời gian đăng kí: <%= regInfor.register %> ngày</p>
                            <p>Lí do nghĩ: <%= regInfor.reason %></p>
                            <p><%= regInfor.confirm ? 'Đã xác nhận' : 'Chưa xác nhận' %></p>
                            <% if (user.isManager && regInfor.confirm === false) { %>
                                <form action="/confirmAnnu" method="post">
                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                    <input type="hidden" value="<%= regInfor._id %>" name="regInfor_id">
                                    <input type="hidden" name="staff_id" value="<%= annu.staff_id %>">
                                    <button class="btn" type="submit">Xác nhận nghĩ phép</button>
                                </form>
                            <% } %>
                        </div>
                    <% } %>
                </div>
            <% } else { %>
                <h4 class="centered">Chưa đăng kí nghĩ phép</h4>
            <% } %>
        </section>
    </main>

<%- include('includes/end.ejs') %>